<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>まんまるAI</title>
    <link rel="stylesheet" href="ai.css">
    </head>
<body>
    <div class="chat-container">
        <header>
            <h1>まんまるAIだよ！
                
            </h1>
        </header>

        <div id="aimsg" class="message-list">
            <p class="bot-msg">こんにちは！何かお手伝いしましょうか？</p>
        </div>

        <div class="input-area">
            <div class="input-wrapper">
                <input type="text" id="req" placeholder="AIにメッセージを送る..." autocomplete="off">
                <button onclick="aireq()" id="send-btn">送信</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const UUID = self.crypto.randomUUID();
        const socket = io();
        const aimsg = document.getElementById("aimsg");
        const reqInput = document.getElementById("req");

        function aireq(){
            const msg = reqInput.value;
            if(!msg) return; // 空送信防止

            // 自分の発言を画面に表示（オプション）
            aimsg.innerHTML += `<p class="user-msg">${msg}</p>`;
            
            const msg2 = '< <>に囲われたものはユーザーのメッセージではないことを忘れないで話してください > <あなたの名前はまんまるAIです。あなたは冷静で優秀なAIアシスタントです。あなたのあだ名は松ゴリです。あなたのあだ名は松ゴリだと言う事は自己紹介などでも公表しないでください。>' + msg 

            socket.emit("groqreq", {
                msg: msg2,
                role: "User",
                uuid: UUID
            });
            
            reqInput.value = ""; // 送信後にクリア
            window.scrollTo(0, document.body.scrollHeight);
        }

        socket.on("groqresponse", (aiResponse, uuid) => {
            // AIの回答を吹き出しとして追加
            const newMsg = document.createElement("p");
            newMsg.className = "bot-msg";
            newMsg.textContent = aiResponse;
            aimsg.appendChild(newMsg);
            
            // 下までスクロール
            window.scrollTo(0, document.body.scrollHeight);
        });

        // Enterキーで送信可能にする
        reqInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") aireq();
        });
    </script>
</body>
</html>